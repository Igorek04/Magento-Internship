<?php
$canceledSubscriptions = $block->getCanceledSubscriptions();
if (empty($canceledSubscriptions))
  return;
?>

<tr>
  <td colspan="3" style="border-top: 0">
    <h3><?= $block->escapeHtml(__("Canceled Subscriptions")); ?></h3>
  </td>
</tr>
<?php foreach ($canceledSubscriptions as $subscription) : ?>
  <?php
  /** @var \StripeIntegration\Payments\Model\Stripe\Subscription $stripeSubscriptionModel */
  $stripeSubscriptionModel = $block->getSubscriptionModel($subscription);
  ?>
  <tr class="<?= $block->escapeHtmlAttr($subscription->id); ?>">
    <td data-th="Order #" class="col order">
      <a href="viewOrder/<?= $block->escapeHtmlAttr($subscription->metadata["Order #"]); ?>">
        <?= $block->escapeHtml($subscription->metadata["Order #"]); ?>
      </a>
    </td>
    <td data-th="<?= $block->escapeHtmlAttr(__("Subscription")); ?>" class="col id">
      <div class="subscription-name">
        <?= $block->escapeHtml($block->getSubscriptionName($subscription)); ?>
      </div>
      <div class="billed">
        <?= /* @noEscape */ $stripeSubscriptionModel->getFormattedBilling(); ?>
      </div>
      <div class="<?= $block->escapeHtmlAttr($subscription->id); ?> payment-method stripe-subscription-edit">
        <div class="static section">
          <div class="details stripe-payments">
            <?php $paymentMethod = $block->getSubscriptionDefaultPaymentMethod($subscription); ?>
            <?php if ($paymentMethod) : ?>
              <img class="icon" src="<?= $block->escapeHtmlAttr($paymentMethod['icon']); ?>" alt="<?= $block->escapeHtmlAttr($paymentMethod['label']); ?>">
              <span class="label"><?= $block->escapeHtml($paymentMethod['label']); ?></span>
              <?php if (!empty($paymentMethod['exp_month'])) : ?>
                <span class="exp">
                  <?= $block->escapeHtml($paymentMethod['exp_month']); ?>/<?= $block->escapeHtml($paymentMethod['exp_year']); ?>
                </span>
              <?php endif; ?>
            <?php else : ?>
              <?= $block->escapeHtml(__("No payment method.")); ?>
            <?php endif; ?>
          </div>
        </div>
      </div>
    </td>
    <td data-th="Actions" class="col">
      <div class="primary">
        <form method="POST" action="<?= $block->escapeUrl($block->getUrl('stripe/subscriptions/reactivate')); ?>">
          <input type="hidden" name="form_key" value="<?= $block->escapeHtmlAttr($block->getFormKey()); ?>">
          <input type="hidden" name="subscription_id" value="<?= $block->escapeHtmlAttr($subscription->id); ?>">
          <button type="submit" class="action"><?= $block->escapeHtml(__('Reactivate')); ?></button>
        </form>
      </div>
    </td>
  </tr>
<?php endforeach; ?>